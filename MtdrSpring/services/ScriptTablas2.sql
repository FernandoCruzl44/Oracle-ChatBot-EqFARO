--------------------------------------------------------
--  DDL for Table COMMENTS
--------------------------------------------------------
CREATE TABLE "TODOUSER"."COMMENTS" (
    "ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "TASK_ID" NUMBER NOT NULL,
    "CONTENT" CLOB NOT NULL,
    "CREATED_BY_ID" NUMBER NOT NULL,
    "CREATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP,
    CONSTRAINT "FK_COMMENT_TASK" FOREIGN KEY ("TASK_ID") REFERENCES "TODOUSER"."TASKS" ("ID") ON DELETE CASCADE,
    CONSTRAINT "FK_COMMENT_CREATOR" FOREIGN KEY ("CREATED_BY_ID") REFERENCES "TODOUSER"."USERS" ("ID")
);
-- Indexes for Table COMMENTS
CREATE INDEX "TODOUSER"."IDX_COMMENT_CREATOR" ON "TODOUSER"."COMMENTS" ("CREATED_BY_ID");
CREATE INDEX "TODOUSER"."IDX_COMMENT_TASK" ON "TODOUSER"."COMMENTS" ("TASK_ID");
--------------------------------------------------------
--  DDL for Table SPRINTS
--------------------------------------------------------
CREATE TABLE "TODOUSER"."SPRINTS" (
    "ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "TEAM_ID" NUMBER NOT NULL,
    "START_DATE" DATE NOT NULL,
    "END_DATE" DATE NOT NULL,
    CONSTRAINT "FK_SPRINT_TEAM" FOREIGN KEY ("TEAM_ID") REFERENCES "TODOUSER"."TEAMS" ("ID")
);
--------------------------------------------------------
--  DDL for Table TASKS
--------------------------------------------------------
CREATE TABLE "TODOUSER"."TASKS" (
    "ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "TITLE" VARCHAR2(255 BYTE) NOT NULL,
    "DESCRIPTION" CLOB,
    "TAG" VARCHAR2(50 BYTE) NOT NULL,
    "STATUS" VARCHAR2(50 BYTE) DEFAULT 'Backlog' NOT NULL,
    "START_DATE" DATE NOT NULL,
    "END_DATE" DATE,
    "CREATED_BY_ID" NUMBER NOT NULL,
    "TEAM_ID" NUMBER,
    "CREATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP,
    "STORY_POINTS" NUMBER,
    "PRIORITY" VARCHAR2(20 BYTE),
    "ESTIMATED_COMPLETION" TIMESTAMP (6),
    CONSTRAINT "CHK_TASK_STATUS" CHECK (
        "STATUS" IN (
            'Backlog',
            'En progreso',
            'Completada',
            'Cancelada',
            'DONE'
        )
    ),
    CONSTRAINT "FK_TASK_CREATOR" FOREIGN KEY ("CREATED_BY_ID") REFERENCES "TODOUSER"."USERS" ("ID"),
    CONSTRAINT "FK_TASK_TEAM" FOREIGN KEY ("TEAM_ID") REFERENCES "TODOUSER"."TEAMS" ("ID")
);
-- Indexes for Table TASKS
CREATE INDEX "TODOUSER"."IDX_TASK_STORY_POINTS" ON "TODOUSER"."TASKS" ("STORY_POINTS");
CREATE INDEX "TODOUSER"."IDX_TASK_TEAM" ON "TODOUSER"."TASKS" ("TEAM_ID");
CREATE INDEX "TODOUSER"."IDX_TASK_CREATOR" ON "TODOUSER"."TASKS" ("CREATED_BY_ID");
--------------------------------------------------------
--  DDL for Table TASK_ASSIGNEE
--------------------------------------------------------
CREATE TABLE "TODOUSER"."TASK_ASSIGNEE" (
    "TASK_ID" NUMBER NOT NULL,
    "USER_ID" NUMBER NOT NULL,
    PRIMARY KEY ("TASK_ID", "USER_ID"),
    CONSTRAINT "FK_ASSIGNEE_TASK" FOREIGN KEY ("TASK_ID") REFERENCES "TODOUSER"."TASKS" ("ID") ON DELETE CASCADE,
    CONSTRAINT "FK_ASSIGNEE_USER" FOREIGN KEY ("USER_ID") REFERENCES "TODOUSER"."USERS" ("ID")
);
--------------------------------------------------------
--  DDL for Table TEAMS
--------------------------------------------------------
CREATE TABLE "TODOUSER"."TEAMS" (
    "ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "NAME" VARCHAR2(255 BYTE) NOT NULL,
    "DESCRIPTION" VARCHAR2(2000 BYTE),
    "CREATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP
);
--------------------------------------------------------
--  DDL for Table USERS
--------------------------------------------------------
CREATE TABLE "TODOUSER"."USERS" (
    "ID" NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    "NAME" VARCHAR2(255 BYTE) NOT NULL,
    "EMAIL" VARCHAR2(255 BYTE) NOT NULL UNIQUE,
    "PASSWORD" VARCHAR2(255 BYTE) NOT NULL,
    "ROLE" VARCHAR2(20 BYTE) NOT NULL,
    "TELEGRAMID" VARCHAR2(255 BYTE),
    "CHATID" VARCHAR2(255 BYTE),
    "CREATED_AT" TIMESTAMP (6) DEFAULT SYSTIMESTAMP,
    "TEAM_ID" NUMBER,
    "TEAM_ROLE" VARCHAR2(50 BYTE),
    CONSTRAINT "FK_USER_TEAM" FOREIGN KEY ("TEAM_ID") REFERENCES "TODOUSER"."TEAMS" ("ID")
);
-- Indexes for Table USERS
CREATE INDEX "TODOUSER"."IDX_USER_TEAM" ON "TODOUSER"."USERS" ("TEAM_ID");